<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üö¥‚Äç‚ôÄÔ∏è Rate Your Track Bogot√°</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet">
    
    <!-- Leaflet.js pour les cartes interactives -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- Donn√©es des pistes cyclables int√©gr√©es -->
    <script src="./data/pistes-data.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'DM Sans', sans-serif;
            background-color: #fafafa;
            color: #333;
            line-height: 1.6;
        }
        
        header {
            background: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: 600;
            color: #2563eb;
        }
        
        nav {
            display: flex;
            gap: 2rem;
            margin-top: 1rem;
        }
        
        nav button {
            background: none;
            border: 2px solid transparent;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-family: inherit;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        nav button:hover {
            background-color: #f1f5f9;
        }
        
        nav button.active {
            background-color: #2563eb;
            color: white;
        }
        
        main {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .section {
            display: none;
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .section.active {
            display: block;
        }
        
        .section h2 {
            color: #1e40af;
            margin-bottom: 1rem;
            font-size: 1.8rem;
        }
        
        .placeholder {
            background: #f8fafc;
            border: 2px dashed #cbd5e1;
            border-radius: 8px;
            padding: 3rem 2rem;
            text-align: center;
            color: #64748b;
            margin-top: 1rem;
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">üö¥‚Äç‚ôÄÔ∏è Rate Your Track Bogot√°</div>
        <nav>
            <button class="nav-btn active" data-section="accueil">Accueil</button>
            <button class="nav-btn" data-section="forum">Forum</button>
            <button class="nav-btn" data-section="carte-existantes">Pistes existantes</button>
            <button class="nav-btn" data-section="carte-souhaitees">Pistes souhait√©es</button>
            <button class="nav-btn" data-section="apropos">√Ä propos</button>
        </nav>
    </header>

    <main>
        <!-- Section Accueil -->
        <section class="section active" id="accueil">
            <h2>üåç Bienvenue sur Rate Your Track Bogot√°</h2>
            <p>Un site collaboratif pour am√©liorer les pistes cyclables de Bogot√° !</p>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; margin-top: 2rem;">
                <div style="background: #f0f9ff; padding: 1.5rem; border-radius: 8px;">
                    <h3>üó£Ô∏è Forum</h3>
                    <p>Discutez avec la communaut√© cycliste</p>
                </div>
                <div style="background: #f0fdf4; padding: 1.5rem; border-radius: 8px;">
                    <h3>üó∫Ô∏è √âvaluez les pistes</h3>
                    <p>Notez la s√©curit√©, le bruit, la qualit√© de l'air...</p>
                </div>
                <div style="background: #fef3f2; padding: 1.5rem; border-radius: 8px;">
                    <h3>‚ú® Proposez des am√©liorations</h3>
                    <p>Tracez de nouvelles pistes sur la carte</p>
                </div>
            </div>
        </section>

        <!-- Section Forum -->
        <section class="section" id="forum">
            <h2>üó£Ô∏è Forum de discussion</h2>
            <p>Espace de discussion pour la communaut√© cycliste de Bogot√°</p>
            <div class="placeholder">
                Interface du forum √† venir...
                <br>Style inspir√© des forums classiques
            </div>
        </section>

        <!-- Section Carte Existantes -->
        <section class="section" id="carte-existantes">
            <h2>üó∫Ô∏è Pistes cyclables existantes</h2>
            <p>√âvaluez les pistes selon 5 crit√®res : S√©curit√©, Bruit, Qualit√© de l'air, Fluidit√©, Accessibilit√©</p>
            
            <!-- Carte interactive -->
            <div id="map-existantes" style="height: 500px; margin-top: 1rem; border-radius: 8px; border: 1px solid #e2e8f0;"></div>
            
            <!-- L√©gende simple -->
            <div style="margin-top: 1rem; padding: 1rem; background: #f8fafc; border-radius: 8px; font-size: 0.9rem;">
                <strong>üéØ Prochainement :</strong> Cliquez sur les pistes pour les noter selon vos 5 crit√®res !
            </div>
        </section>

        <!-- Section Carte Souhait√©es -->
        <section class="section" id="carte-souhaitees">
            <h2>‚ú® Pistes cyclables souhait√©es</h2>
            <p>Proposez de nouveaux trac√©s pour am√©liorer le r√©seau cyclable</p>
            <div class="placeholder">
                Carte avec outils de dessin √† venir...
                <br>Tracez vos pistes id√©ales !
            </div>
        </section>

        <!-- Section √Ä propos -->
        <section class="section" id="apropos">
            <h2>üìã √Ä propos du projet</h2>
            <p><strong>Objectif :</strong> F√©d√©rer la communaut√© cycliste de Bogot√° pour am√©liorer la s√©curit√© et rendre le v√©lo plus attractif.</p>
            
            <div style="margin-top: 2rem;">
                <h3>üéØ Mission</h3>
                <ul style="margin-left: 2rem; margin-top: 0.5rem;">
                    <li>Am√©liorer la s√©curit√© des cyclistes</li>
                    <li>Encourager la participation citoyenne</li>
                    <li>Promouvoir le v√©lo comme alternative √† la voiture</li>
                </ul>
            </div>

            <div style="margin-top: 2rem;">
                <h3>üìß Contact</h3>
                <p>Pour toute question : <strong>contact@rateyourtrack-bogota.com</strong></p>
            </div>
        </section>
    </main>

    <script>
        // Variables globales
        let mapExistantes = null;

        // Navigation simple
        const navButtons = document.querySelectorAll('.nav-btn');
        const sections = document.querySelectorAll('.section');

        navButtons.forEach(button => {
            button.addEventListener('click', () => {
                // Retirer active de tous les boutons et sections
                navButtons.forEach(btn => btn.classList.remove('active'));
                sections.forEach(section => section.classList.remove('active'));
                
                // Activer le bouton cliqu√©
                button.classList.add('active');
                
                // Afficher la section correspondante
                const targetSection = button.getAttribute('data-section');
                document.getElementById(targetSection).classList.add('active');
                
                // Initialiser la carte si on va sur la section carte-existantes
                if (targetSection === 'carte-existantes' && !mapExistantes) {
                    initMapExistantes();
                }
            });
        });

        // Fonction pour initialiser la carte des pistes existantes
        function initMapExistantes() {
            try {
                console.log('Initialisation de la carte...');
                
                // Cr√©er la carte centr√©e sur Bogot√° avec zoom optimal
                mapExistantes = L.map('map-existantes', {
                    maxZoom: 18  // Limiter le zoom max pour √©viter le flou
                }).setView([4.6097, -74.0817], 13);  // Zoom initial un peu plus proche
                
                // Couches de base avec zoom optimis√©
                const baseNeutre = L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
                    attribution: '¬© OpenStreetMap contributors | ¬© CARTO',
                    maxZoom: 18  // Zoom coh√©rent
                });
                
                const baseStandard = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '¬© OpenStreetMap contributors',
                    maxZoom: 18  // Zoom coh√©rent
                });
                
                // Ajouter la couche de base par d√©faut
                baseNeutre.addTo(mapExistantes);
                
                // Contr√¥le des couches (seulement les fonds de carte)
                const baseMaps = {
                    "üé® Carte neutre": baseNeutre,
                    "üìç Carte standard": baseStandard
                };
                
                L.control.layers(baseMaps).addTo(mapExistantes);
                
                // Utiliser les donn√©es int√©gr√©es directement (√©vite les probl√®mes CORS)
                console.log('üîç Chargement des pistes cyclables...');
                
                try {
                    if (typeof pistesCyclablesBogota === 'undefined') {
                        throw new Error('Donn√©es des pistes non disponibles');
                    }
                    
                    console.log('‚úÖ Donn√©es charg√©es:', pistesCyclablesBogota.features.length, 'pistes principales');
                    
                    // Ajouter les pistes cyclables √† la carte
                    const pistesLayer = L.geoJSON(pistesCyclablesBogota, {
                        style: function(feature) {
                            return {
                                color: '#22c55e',
                                weight: 3,
                                opacity: 0.8
                            };
                        },
                        onEachFeature: function(feature, layer) {
                            const props = feature.properties;
                            layer.bindPopup(`
                                <strong>üö¥‚Äç‚ôÄÔ∏è ${props.name}</strong><br>
                                <em>Type:</em> ${props.highway}<br>
                                <em>Surface:</em> ${props.surface}<br>
                                <em>Cycleway:</em> ${props.cycleway}<br>
                                <br>
                                <button onclick="noterPiste('${feature.id}')">‚≠ê Noter cette piste</button>
                            `);
                        }
                    }).addTo(mapExistantes);
                    
                    console.log('üó∫Ô∏è Pistes ajout√©es √† la carte !');
                    
                    // Ajuster la vue sur les pistes
                    if (pistesCyclablesBogota.features.length > 0) {
                        mapExistantes.fitBounds(pistesLayer.getBounds(), {padding: [20, 20]});
                    }
                    
                } catch (error) {
                    console.error('‚ùå Erreur:', error);
                    L.popup()
                        .setLatLng([4.6097, -74.0817])
                        .setContent(`‚ùå Erreur: ${error.message}`)
                        .openOn(mapExistantes);
                }
                
                // Marqueur centre-ville
                L.marker([4.6097, -74.0817])
                    .addTo(mapExistantes)
                    .bindPopup('üìç Centro de Bogot√°<br>Explorez les pistes cyclables !');
                
                console.log('Carte initialis√©e avec succ√®s !');
                
                // Forcer le redimensionnement de la carte
                setTimeout(() => {
                    mapExistantes.invalidateSize();
                }, 200);
                
            } catch (error) {
                console.error('Erreur lors de l\'initialisation de la carte:', error);
                document.getElementById('map-existantes').innerHTML = 
                    '<div style="padding: 2rem; text-align: center; color: #ef4444;">‚ùå Erreur lors du chargement de la carte. V√©rifiez votre connexion internet.</div>';
            }
        }

        // Fonction pour noter une piste (placeholder pour l'instant)
        function noterPiste(pisteId) {
            alert(`üéØ Bient√¥t : Interface de notation pour la piste ${pisteId} !`);
            // TODO: Impl√©menter l'interface de notation avec les 5 crit√®res
        }

        // Initialiser la carte apr√®s le chargement de la page si Leaflet est disponible
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof L === 'undefined') {
                console.error('Leaflet n\'est pas charg√© !');
                document.getElementById('map-existantes').innerHTML = 
                    '<div style="padding: 2rem; text-align: center; color: #ef4444;">‚ùå Leaflet.js n\'a pas pu se charger</div>';
            } else {
                console.log('Leaflet charg√© avec succ√®s !');
            }
        });
    </script>
</body>
</html>
